<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-5">
  <h2>ðŸ“Š Admin Dashboard</h2>
  <table class="table table-bordered mt-3" id="urlTable">
    <thead>
      <tr>
        <th>Short URL</th>
        <th>Original URL</th>
        <th>Clicks</th>
        <th>QR Code</th>
      </tr>
    </thead>
    <tbody id="urlBody">
    </tbody>
  </table>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    async function loadUrls() {
      try {
        const res = await axios.get('/admin/all');
        const tbody = document.getElementById('urlBody');
        tbody.innerHTML = '';

        res.data.forEach(link => {
          // Use 0 as default for clicks if not present
          const clicks = link.clicks !== undefined ? link.clicks : 0;
          const row = document.createElement('tr');
          row.innerHTML = `
            <td><a href="/${link.shortenUrlKey}" target="_blank">${link.shortenUrlKey}</a></td>
            <td>${link.originalUrl}</td>
            <td>${clicks}</td>
            <td>
              <img src="https://api.qrserver.com/v1/create-qr-code/?data=${encodeURIComponent(location.origin + '/' + link.shortenUrlKey)}&amp;size=80x80" alt="QR code"/>
            </td>
          `;
          tbody.appendChild(row);
        });
      } catch (err) {
        alert('Failed to load URLs.');
      }
    }

    loadUrls();
  </script>
</body>
</html>
